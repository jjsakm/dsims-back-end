<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.com.edoc.clsf.domain.repository.PrvcFileHldPrstMapper">
	
	<sql id="fields">
		pfhp.doc_clsf_no,
		pfhp.prvc_file_hld_prst_no,
		pfhp.dept_nm,
		pfhp.file_nm,
		pfhp.hld_prps,
		pfhp.clct_stt_bss_expln,
		pfhp.use_dept_nm,
		pfhp.prvc_prcs_mthd_expln,
		pfhp.hld_prd_dfyrs,
		pfhp.hld_prd_mm_cnt,
		pfhp.info_mnbd_prvc_mttr,
		pfhp.stty_agt_prvc_mttr,
		pfhp.rrno_clct_yn,
		pfhp.rrno_clct_stt_bss_expln,
		pfhp.info_mnbd_agre_yn,
		pfhp.info_mnbd_dsag_clct_stt_bss_expln,
		pfhp.sens_info_hld_yn,
		pfhp.sens_info_indiv_agre_yn,
		pfhp.sens_info_hld_stt_bss_expln,
		pfhp.uii_hld_yn, uii_indiv_agre_yn,
		pfhp.uii_hld_stt_bss_expln,
		pfhp.prvc_evl_trgt_yn,
		pfhp.hndl_pic_nm,
		pfhp.tdpty_splrcp_nm,
		pfhp.tdpty_pvsn_bss_expln,
		pfhp.tdpty_pvsn_mttr,
		pfhp.prvc_prcs_cnsgn_bzenty_nm,
		pfhp.prvc_cnsgn_ctrt_yn,
		pfhp.prvc_cnsgn_fact_indct_yn,
		pfhp.prps_excl_utztn_pvsn_yn,
		pfhp.prps_excl_utztn_pvsn_bss_expln,
		pfhp.reg_ymd,
		pfhp.rgtr_id,
		pfhp.mdfcn_ymd,
		pfhp.mdfr_id
	</sql>
	
	<sql id="mainTable">
		tb_dr_m_prvc_file_hld_prst AS pfhp
	</sql>
	
	<sql id="fromTables">
		<include refid="mainTable" />
	</sql>

    <insert id="insert" useGeneratedKeys="true" keyColumn="prvc_file_hld_prst_no" keyProperty="prvcFileHldPrstNo">
    INSERT INTO <include refid="mainTable" />
	(
		doc_clsf_no, prvc_file_hld_prst_no,
		dept_nm,
		file_nm,
		hld_prps,
		clct_stt_bss_expln,
		use_dept_nm,
		prvc_prcs_mthd_expln,
		hld_prd_dfyrs,
		hld_prd_mm_cnt,
		info_mnbd_prvc_mttr,
		stty_agt_prvc_mttr,
		rrno_clct_yn,
		rrno_clct_stt_bss_expln,
		info_mnbd_agre_yn,
		info_mnbd_dsag_clct_stt_bss_expln,
	  	sens_info_hld_yn,
		sens_info_indiv_agre_yn,
		sens_info_hld_stt_bss_expln,
		uii_hld_yn,
		uii_indiv_agre_yn,
	 	uii_hld_stt_bss_expln,
		prvc_evl_trgt_yn,
		hndl_pic_nm,
		tdpty_splrcp_nm,
		tdpty_pvsn_bss_expln,
	  	tdpty_pvsn_mttr,
		prvc_prcs_cnsgn_bzenty_nm,
		prvc_cnsgn_ctrt_yn,
		prvc_cnsgn_fact_indct_yn,
	  	prps_excl_utztn_pvsn_yn,
		prps_excl_utztn_pvsn_bss_expln,
		reg_ymd,
		rgtr_id,
		mdfcn_ymd,
		mdfr_id
	 )
	VALUES
	(
		#{docClsfNo},
		(SELECT 'MPRV' || to_char(NOW(), 'YYYYMMDD') || coalesce(max(substring(prvc_file_hld_prst_no, 13)::integer)+1,1) FROM <include refid="mainTable" /> WHERE prvc_file_hld_prst_no LIKE 'MDOC' || to_char(NOW(), 'YYYYMMDD') || '%'),
		#{deptNm},
		#{fileNm},
		#{hldPrps},
		#{clctSttBssExpln},
		#{useDeptNm},
		#{prvcPrcsMthdExpln},
		#{hldPrdDfyrs}::NUMERIC,
		#{hldPrdMmCnt}::NUMERIC,
		#{infoMnbdPrvcMttr},
		#{sttyAgtPrvcMttr},
		#{rrnoClctYn},
		#{rrnoClctSttBssExpln},
		#{infoMnbdAgreYn},
		#{infoMnbdDsagClctSttBssExpln},
		#{sensInfoHldYn},
		#{sensInfoIndivAgreYn},
		#{sensInfoHldSttBssExpln},
		#{uiiHldYn},
		#{uiiIndivAgreYn},
		#{uiiHldSttBssExpln},
		#{prvcEvlTrgtYn},
		#{hndlPicNm},
		#{tdptySplrcpNm},
		#{tdptyPvsnBssExpln},
		#{tdptyPvsnMttr},
		#{prvcPrcsCnsgnBzentyNm},
		#{prvcCnsgnCtrtYn},
		#{prvcCnsgnFactIndctYn},
		#{prpsExclUtztnPvsnYn},
		#{prpsExclUtztnPvsnBssExpln},
		NOW(),
		#{rgtrId},
		NOW(),
		#{mdfrId}
	)
    </insert>
    

	<update id="update">
		UPDATE <include refid="mainTable" />
		SET
			dept_nm = #{deptNm},
			file_nm = #{fileNm},
			hld_prps = #{hldPrps},
			clct_stt_bss_expln = #{clctSttBssExpln},
			use_dept_nm = #{useDeptNm},
			prvc_prcs_mthd_expln = #{prvcPrcsMthdExpln},
			hld_prd_dfyrs = #{hldPrdDfyrs}::NUMERIC,
			hld_prd_mm_cnt = #{hldPrdMmCnt}::NUMERIC,
			info_mnbd_prvc_mttr = #{infoMnbdPrvcMttr},
			stty_agt_prvc_mttr = #{sttyAgtPrvcMttr},
			rrno_clct_yn = #{rrnoClctYn},
			rrno_clct_stt_bss_expln = #{rrnoClctSttBssExpln},
			info_mnbd_agre_yn = #{infoMnbdAgreYn},
			info_mnbd_dsag_clct_stt_bss_expln = #{infoMnbdDsagClctSttBssExpln},
			sens_info_hld_yn = #{sensInfoHldYn},
			sens_info_indiv_agre_yn = #{sensInfoIndivAgreYn},
			sens_info_hld_stt_bss_expln = #{sensInfoHldSttBssExpln},
			uii_hld_yn = #{uiiHldYn},
			uii_indiv_agre_yn = #{uiiIndivAgreYn},
			uii_hld_stt_bss_expln = #{uiiHldSttBssExpln},
			prvc_evl_trgt_yn = #{prvcEvlTrgtYn},
			hndl_pic_nm = #{hndlPicNm},
			tdpty_splrcp_nm = #{tdptySplrcpNm},
			tdpty_pvsn_bss_expln = #{tdptyPvsnBssExpln},
			tdpty_pvsn_mttr = #{tdptyPvsnMttr},
			prvc_prcs_cnsgn_bzenty_nm = #{prvcPrcsCnsgnBzentyNm},
			prvc_cnsgn_ctrt_yn = #{prvcCnsgnCtrtYn},
			prvc_cnsgn_fact_indct_yn = #{prvcCnsgnFactIndctYn}, 
			prps_excl_utztn_pvsn_yn = #{prpsExclUtztnPvsnYn},
			prps_excl_utztn_pvsn_bss_expln = #{prpsExclUtztnPvsnBssExpln},
			mdfcn_ymd = NOW(),
			mdfr_id = #{mdfrId}	 
		WHERE
			doc_clsf_no = #{docClsfNo} AND prvc_file_hld_prst_no = #{prvcFileHldPrstNo}
	</update>
	
	<delete id="delete">
		DELETE FROM
			<include refid="mainTable" />
		WHERE
			doc_clsf_no = #{docClsfNo}

	</delete>

	<select id="select" resultType="egovframework.com.edoc.clsf.domain.model.PrvcFileHldPrstVO">
		SELECT
			<include refid="fields"/>
		FROM
			<include refid="fromTables"/>
		WHERE
			pfhp.doc_clsf_no = #{docClsfNo}
 		
 	</select>

</mapper>